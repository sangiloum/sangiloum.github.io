{{ define "main" }}
{{ $slug := .Params.category_slug | default (.Title | urlize) }}
{{ $name := .Params.category_name | default .Title }}
{{ $posts := slice }}
{{ range (where site.RegularPages "Section" "posts") }}
  {{ $matched := false }}
  {{ range (.Params.categories | default (slice)) }}
    {{ if eq (. | urlize) $slug }}{{ $matched = true }}{{ end }}
  {{ end }}
  {{ if $matched }}{{ $posts = $posts | append . }}{{ end }}
{{ end }}
{{ $posts = sort $posts "Date" "desc" }}
{{ $p := .Paginate $posts }}
<article class="page">
  <header class="page-header"><h1>{{ .Title }}</h1></header>
  <div class="blog-layout">
    {{ partial "blog-categories.html" (dict "active" $name) }}
    <section class="blog-main">
      <h2>Posts in "{{ $name }}"</h2>
      {{ partial "post-cards.html" (dict "posts" $p.Pages "category_filter" $name) }}
      {{ if gt $p.TotalPages 1 }}
      <nav class="list-pagination" aria-label="Category post pages">
        {{ if $p.HasPrev }}<a class="list-pagination-link" href="{{ $p.Prev.URL }}">← Newer</a>{{ else }}<span class="list-pagination-link is-disabled">← Newer</span>{{ end }}
        <span class="list-pagination-status">Page {{ $p.PageNumber }} of {{ $p.TotalPages }}</span>
        {{ if $p.HasNext }}<a class="list-pagination-link" href="{{ $p.Next.URL }}">Older →</a>{{ else }}<span class="list-pagination-link is-disabled">Older →</span>{{ end }}
      </nav>
      {{ end }}
    </section>
  </div>
</article>
{{ end }}
