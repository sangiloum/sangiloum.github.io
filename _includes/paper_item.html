{%- assign paper = include.paper -%}
{%- assign title_href = nil -%}
{%- if paper.doi -%}
  {%- assign title_href = 'https://doi.org/' | append: paper.doi -%}
{%- elsif paper.arxiv -%}
  {%- assign title_href = 'https://arxiv.org/abs/' | append: paper.arxiv -%}
{%- elsif paper.url -%}
  {%- assign title_href = paper.url -%}
{%- endif -%}

{%- assign month_num = paper.month | plus: 0 -%}
{%- assign month_name = nil -%}
{%- case month_num -%}
  {%- when 1 -%}{%- assign month_name = "January" -%}
  {%- when 2 -%}{%- assign month_name = "February" -%}
  {%- when 3 -%}{%- assign month_name = "March" -%}
  {%- when 4 -%}{%- assign month_name = "April" -%}
  {%- when 5 -%}{%- assign month_name = "May" -%}
  {%- when 6 -%}{%- assign month_name = "June" -%}
  {%- when 7 -%}{%- assign month_name = "July" -%}
  {%- when 8 -%}{%- assign month_name = "August" -%}
  {%- when 9 -%}{%- assign month_name = "September" -%}
  {%- when 10 -%}{%- assign month_name = "October" -%}
  {%- when 11 -%}{%- assign month_name = "November" -%}
  {%- when 12 -%}{%- assign month_name = "December" -%}
{%- endcase -%}

{%- capture coauthor_text -%}
  {%- if paper.coauthors and paper.coauthors.size > 0 -%}
with {% assign co_count = paper.coauthors.size %}{% for cid in paper.coauthors %}{% assign co = site.data.coauthors | where: "id", cid | first %}{% if co %}{% capture co_name %}{{ co.firstname }}{% if co.lastname != "" %} {{ co.lastname }}{% endif %}{% if co.korname %}<sup>{{ co.korname }}</sup>{% endif %}{% endcapture %}{% if co.url %}<a href="{{ co.url }}">{{ co_name | strip }}</a>{% else %}{{ co_name | strip }}{% endif %}{% else %}{{ cid }}{% endif %}{% unless forloop.last %}{% if co_count == 2 %} and {% elsif forloop.rindex == 2 %}, and {% else %}, {% endif %}{% endunless %}{% endfor %}
  {%- endif -%}
{%- endcapture -%}

{%- assign coauthor_ids = '' -%}
{%- if paper.coauthors and paper.coauthors.size > 0 -%}
  {%- assign coauthor_ids = paper.coauthors | join: ',' -%}
{%- endif -%}

{%- capture text_html -%}{{ paper.text | markdownify }}{%- endcapture -%}
{%- assign text_html = text_html | strip | remove: '<p>' | remove: '</p>' -%}

{%- capture note_html -%}{%- if paper.note -%}{{ paper.note | markdownify }}{%- endif -%}{%- endcapture -%}
{%- assign note_html = note_html | strip | remove: '<p>' | remove: '</p>' -%}

<li class="paper-item" data-year="{{ paper.year }}" data-coauthors="{{ coauthor_ids }}">
  <div class="paper-item-main">
    {%- if title_href -%}<a href="{{ title_href }}"><strong>{{ paper.title }}</strong></a>{%- else -%}<strong>{{ paper.title }}</strong>{%- endif -%}{% if coauthor_text != '' %} ({{ coauthor_text | strip }}){% endif %}{% if text_html != '' %}, {{ text_html }}{% endif %}, {% if month_name %}{{ month_name }} {% endif %}{{ paper.year }}.{% if note_html != '' %} {{ note_html }}.{% endif %}
  </div>
  {% if paper.doi or paper.arxiv %}
  <div class="paper-item-links">
    {%- if paper.doi -%}<a class="paper-meta-link paper-meta-link-doi" data-label="doi" href="https://doi.org/{{ paper.doi }}"><span class="paper-meta-value"><span class="paper-copy-hidden">https://doi.org/</span>{{ paper.doi }}</span></a>{%- endif -%}
    {%- if paper.arxiv -%}<a class="paper-meta-link paper-meta-link-arxiv" data-label="arXiv" href="https://arxiv.org/abs/{{ paper.arxiv }}"><span class="paper-meta-value"><span class="paper-copy-hidden">https://arxiv.org/abs/</span>{{ paper.arxiv }}</span></a>{%- endif -%}
  </div>
  {%- endif -%}
</li>
