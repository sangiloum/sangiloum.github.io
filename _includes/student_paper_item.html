{%- assign paper = include.paper -%}
{%- assign title_href = nil -%}
{%- if paper.link -%}
  {%- assign title_href = paper.link -%}
{%- elsif paper.doi -%}
  {%- assign title_href = 'https://doi.org/' | append: paper.doi -%}
{%- elsif paper.arxiv -%}
  {%- assign title_href = 'https://arxiv.org/abs/' | append: paper.arxiv -%}
{%- elsif paper.url and paper.url contains '://' -%}
  {%- assign title_href = paper.url -%}
{%- endif -%}

{%- assign month_num = paper.month | plus: 0 -%}
{%- assign month_name = nil -%}
{%- case month_num -%}
  {%- when 1 -%}{%- assign month_name = "January" -%}
  {%- when 2 -%}{%- assign month_name = "February" -%}
  {%- when 3 -%}{%- assign month_name = "March" -%}
  {%- when 4 -%}{%- assign month_name = "April" -%}
  {%- when 5 -%}{%- assign month_name = "May" -%}
  {%- when 6 -%}{%- assign month_name = "June" -%}
  {%- when 7 -%}{%- assign month_name = "July" -%}
  {%- when 8 -%}{%- assign month_name = "August" -%}
  {%- when 9 -%}{%- assign month_name = "September" -%}
  {%- when 10 -%}{%- assign month_name = "October" -%}
  {%- when 11 -%}{%- assign month_name = "November" -%}
  {%- when 12 -%}{%- assign month_name = "December" -%}
{%- endcase -%}

{%- assign mystudents = paper.mystudents | default: empty -%}
{%- assign author_ids = paper.authors | default: empty -%}
{%- assign author_ids_csv = author_ids | join: ',' -%}
{%- assign mystudents_csv = mystudents | join: ',' -%}

{%- capture author_text -%}
  {%- if author_ids and author_ids.size > 0 -%}
{% assign co_count = author_ids.size %}{% for aid in author_ids %}{% assign person = site.data.people | where: "id", aid | first %}{% capture person_name %}{% if person %}{{ person.firstname }}{% if person.lastname != "" %} {{ person.lastname }}{% endif %}{% if person.korname %}<sup>{{ person.korname }}</sup>{% endif %}{% else %}{{ aid }}{% endif %}{% endcapture %}{% capture person_rendered %}{% if person and person.url %}<a href="{{ person.url }}">{{ person_name | strip }}</a>{% else %}{{ person_name | strip }}{% endif %}{% endcapture %}{% if mystudents contains aid %}<strong>{{ person_rendered | strip }}</strong>{% else %}{{ person_rendered | strip }}{% endif %}{% unless forloop.last %}{% if co_count == 2 %} and {% elsif forloop.rindex == 2 %}, and {% else %}, {% endif %}{% endunless %}{% endfor %}
  {%- endif -%}
{%- endcapture -%}

{%- for sid in mystudents -%}
  {%- unless author_ids contains sid -%}
    <!-- Warning: mystudents contains unknown author slug {{ sid }} in {{ page.path }} -->
  {%- endunless -%}
{%- endfor -%}

{%- capture journal_html -%}{%- if paper.journal -%}{{ paper.journal | markdownify }}{%- endif -%}{%- endcapture -%}
{%- assign journal_html = journal_html | strip | remove: '<p>' | remove: '</p>' -%}
{%- capture conference_html -%}{%- if paper.conference -%}{{ paper.conference | markdownify }}{%- endif -%}{%- endcapture -%}
{%- assign conference_html = conference_html | strip | remove: '<p>' | remove: '</p>' -%}
{%- capture booktitle_html -%}{%- if paper.booktitle -%}{{ paper.booktitle | markdownify }}{%- endif -%}{%- endcapture -%}
{%- assign booktitle_html = booktitle_html | strip | remove: '<p>' | remove: '</p>' -%}
{%- capture text_html -%}{{ paper.text | markdownify }}{%- endcapture -%}
{%- assign text_html = text_html | strip | remove: '<p>' | remove: '</p>' -%}
{%- capture note_html -%}{%- if paper.note -%}{{ paper.note | markdownify }}{%- endif -%}{%- endcapture -%}
{%- assign note_html = note_html | strip | remove: '<p>' | remove: '</p>' -%}

<li class="paper-item student-paper-item" data-year="{{ paper.year }}" data-authors="{{ author_ids_csv }}" data-mystudents="{{ mystudents_csv }}">
  <div class="paper-item-main">
    {% if author_text != '' %}{{ author_text | strip }}, {% endif %}{%- if title_href -%}<a href="{{ title_href }}"><em>{{ paper.title }}</em></a>{%- else -%}<em>{{ paper.title }}</em>{%- endif -%}{% if journal_html != '' %}, <em>{{ journal_html }}</em>{% endif %}{% if conference_html != '' %}, {{ conference_html }}{% endif %}{% if booktitle_html != '' %}, {{ booktitle_html }}{% endif %}{% if text_html != '' %}, {{ text_html }}{% endif %}, {% if month_name %}{{ month_name }} {% endif %}{{ paper.year }}.{% if note_html != '' %} {{ note_html }}.{% endif %}
  </div>
  {% if paper.doi or paper.arxiv %}
  <div class="paper-item-links">
    {%- if paper.doi -%}<a class="paper-meta-link paper-meta-link-doi" data-label="doi" href="https://doi.org/{{ paper.doi }}"><span class="paper-meta-value"><span class="paper-copy-hidden">https://doi.org/</span>{{ paper.doi }}</span></a>{%- endif -%}
    {%- if paper.arxiv -%}<a class="paper-meta-link paper-meta-link-arxiv" data-label="arXiv" href="https://arxiv.org/abs/{{ paper.arxiv }}"><span class="paper-meta-value"><span class="paper-copy-hidden">https://arxiv.org/abs/</span>{{ paper.arxiv }}</span></a>{%- endif -%}
  </div>
  {%- endif -%}
</li>
